.TH SDME 1 "2026-02-22" "sdme" "User Commands"
.SH NAME
sdme \- lightweight systemd\-nspawn containers with overlayfs
.SH SYNOPSIS
.B sdme
[\fB\-v\fR] [\fB\-c\fR \fIpath\fR]
.I command
[\fIargs\fR...]
.SH DESCRIPTION
.B sdme
manages lightweight containers using
.BR systemd\-nspawn (1)
with overlayfs copy\-on\-write storage.
Each container uses an imported root filesystem as its read\-only lower layer,
keeping the base rootfs untouched while all modifications are stored in a
per\-container upper layer.
.PP
Containers are managed as systemd template units
.RB ( sdme@.service )
and controlled via D\-Bus.
Interactive access uses
.BR machinectl (1).
.PP
.B sdme
requires root privileges.
When invoked via
.BR sudo (8),
the invoking user's configuration file is preferred.
.SH OPTIONS
.TP
.BR \-v ", " \-\-verbose
Enable verbose output.
Implies non\-interactive mode at runtime.
.TP
.BR \-c ", " \-\-config " " \fIpath\fR
Path to config file.
Default:
.IR ~/.config/sdme/sdmerc .
.SH COMMANDS
.SS sdme new [\fIname\fR] [\-r \fIfs\fR] [\-t \fIseconds\fR] [\-\-] [\fIcommand\fR...]
Create, start, and enter a new container.
If
.I name
is omitted, a name is generated automatically.
If
.B \-r
is omitted, the host filesystem is used.
Use
.B \-t
to override the boot timeout (default: 60 seconds or the
.B boot_timeout
config value).
An optional command overrides the default login shell.
.SS sdme create [\fIname\fR] [\-r \fIfs\fR]
Create a new container without starting it.
Sets up the overlayfs directories and state file.
.SS sdme start \fIname\fR [\-t \fIseconds\fR]
Start a stopped container.
Installs or updates the
.B sdme@.service
template unit if needed, then starts the unit via D\-Bus.
Use
.B \-t
to override the boot timeout (default: 60 seconds or the
.B boot_timeout
config value).
.SS sdme join \fIname\fR [\-\-] [\fIcommand\fR...]
Enter a running container using
.BR machinectl (1)
shell.
An optional command overrides the default login shell.
.SS sdme exec \fIname\fR \fIcommand\fR [\fIargs\fR...]
Run a one\-off command in a running container using
.BR machinectl (1)
shell.
.SS sdme stop [\-a] \fIname\fR...
Stop one or more running containers via D\-Bus (TerminateMachine)
for a clean shutdown.
Use
.B \-a
to stop all running containers (cannot be combined with names).
.SS sdme rm [\-a] \fIname\fR...
Remove one or more containers.
Running containers are stopped first.
Deletes the state file and all overlayfs directories.
Use
.B \-a
to remove all containers (cannot be combined with names).
.SS sdme ps
List all containers with their status, health, detected OS, and shared directory path.
Health checks detect broken containers (missing directories, missing rootfs).
The OS column shows the distro name from the rootfs os\-release file.
.SS sdme logs \fIname\fR [\fIargs\fR...]
View container logs by executing
.BR journalctl (1)
for the container's service unit.
Extra arguments are passed through to journalctl
(e.g.\&
.BR \-f ,
.BR "\-n 100" ).
.SS sdme fs import \fIsource\fR \-n \fIname\fR [\-f] [\-\-install\-packages \fImode\fR]
Import a root filesystem.
After import, systemd is detected in the rootfs; if missing, distro\-specific
packages can be installed via chroot.
The
.B \-\-install\-packages
flag controls this:
.B auto
(default) prompts interactively,
.B yes
always installs,
.B no
refuses if systemd is absent.
.PP
The source type is auto\-detected:
.RS
.IP \(bu 2
.B URL
.RI ( http:// " or " https:// )
\(em download and extract tarball
.IP \(bu 2
.B Directory
\(em copy the directory tree
.IP \(bu 2
.B QCOW2 image
(detected by magic bytes) \(em mount via
.BR qemu\-nbd (8)
and copy the filesystem tree
.IP \(bu 2
.B Tarball
.RI ( .tar ", " .tar.gz ", " .tar.bz2 ", " .tar.xz ", " .tar.zst )
\(em extract using native Rust crates with magic\-byte compression detection.
OCI container images are auto\-detected after extraction and their filesystem
layers are applied in order with whiteout handling.
.RE
.PP
Use
.B \-f
to remove a leftover staging directory from a previous failed import.
.SS sdme fs ls
List imported root filesystems with distro detection and paths.
.SS sdme fs rm \fIname\fR...
Remove one or more imported root filesystems.
.SS sdme config get
Show current configuration values.
.SS sdme config set \fIkey\fR \fIvalue\fR
Set a configuration value.
Valid keys:
.RS
.TP
.B interactive
Enable or disable interactive mode.
Values:
.BR yes " or " no .
Default:
.BR yes .
.TP
.B datadir
Absolute path to the data directory.
Default:
.BR /var/lib/sdme .
.TP
.B boot_timeout
Boot timeout in seconds.
Values: positive integer.
Default:
.BR 60 .
.TP
.B join_as_sudo_user
Automatically join host\-rootfs containers as the
.B SUDO_USER
instead of root.
Values:
.BR yes " or " no .
Default:
.BR yes .
.RE
.SH CONFIGURATION
The configuration file is in TOML format, located at
.IR ~/.config/sdme/sdmerc .
When running under
.BR sudo (8),
the invoking user's config is preferred if it exists.
The path can also be set via the
.B \-c
option or the
.B XDG_CONFIG_HOME
environment variable.
.PP
Available keys:
.TP
.B interactive
Boolean.
Whether to run in interactive mode.
Default:
.BR true .
.TP
.B datadir
String.
Absolute path to the data directory.
Default:
.BR /var/lib/sdme .
.TP
.B boot_timeout
Integer.
Number of seconds to wait for a container to finish booting before giving up.
Can be overridden per\-command with
.BR \-t / \-\-timeout .
Default:
.BR 60 .
.TP
.B join_as_sudo_user
Boolean.
When true and the container uses the host root filesystem,
.B sdme join
and
.B sdme exec
pass
.BI \-\-uid " SUDO_USER"
to
.BR machinectl (1)
so the session runs as the invoking user rather than root.
Containers created with an imported rootfs are unaffected.
Default:
.BR true .
.SH FILES
.TP
.I /var/lib/sdme/
Default data directory (configurable via
.BR datadir ).
.TP
.I /var/lib/sdme/fs/\fIname\fR/
Imported root filesystems (lower layers).
.TP
.I /var/lib/sdme/state/\fIname\fR
Container state files (KEY=VALUE format).
.TP
.I /var/lib/sdme/containers/\fIname\fR/upper/
Per\-container overlayfs upper layer (copy\-on\-write modifications).
.TP
.I /var/lib/sdme/containers/\fIname\fR/work/
Per\-container overlayfs work directory.
.TP
.I /var/lib/sdme/containers/\fIname\fR/merged/
Per\-container overlayfs merged mount point.
.TP
.I /var/lib/sdme/containers/\fIname\fR/shared/
Per\-container shared directory (accessible from host and container).
.TP
.I /etc/systemd/system/sdme@.service
Systemd template unit (auto\-installed and auto\-updated).
.TP
.I ~/.config/sdme/sdmerc
User configuration file (TOML format).
.SH ENVIRONMENT
.TP
.B SUDO_USER
When set, sdme reads the invoking user's configuration file and resolves
their home directory for config file lookup.
.TP
.B XDG_CONFIG_HOME
Overrides the base directory for the configuration file.
Default:
.IR ~/.config .
.TP
.B HOME
Used to locate the configuration file when
.B XDG_CONFIG_HOME
is not set.
.TP
.BR https_proxy ", " HTTPS_PROXY ", " http_proxy ", " HTTP_PROXY ", " all_proxy ", " ALL_PROXY
Proxy URI for HTTP/HTTPS downloads during
.BR "sdme fs import" .
The first non\-empty variable found (in the order listed) is used.
Example:
.IR http://proxy:3128 .
Since
.B sdme
requires root, pass proxy variables through
.BR sudo (8)
with
.B \-E
or by setting them inline.
.TP
.BR no_proxy ", " NO_PROXY
Comma\-separated list of hosts or domains that should bypass the proxy.
.SH EXIT STATUS
.TP
.B 0
Success.
.TP
.B non\-zero
An error occurred.
Error messages are printed to standard error.
.SH EXAMPLES
Import an Ubuntu rootfs from a URL and create a container:
.PP
.RS
.nf
sdme fs import https://example.com/ubuntu.tar.xz \-n ubuntu
sdme new mybox \-r ubuntu
.fi
.RE
.PP
Run a command in a running container:
.PP
.RS
.nf
sdme exec mybox cat /etc/os\-release
.fi
.RE
.PP
Follow logs for a container:
.PP
.RS
.nf
sdme logs mybox \-f
.fi
.RE
.PP
Import a rootfs through an HTTP proxy:
.PP
.RS
.nf
sudo \-E sdme fs import https://example.com/ubuntu.tar.xz \-n ubuntu
.fi
.RE
.PP
Or pass the proxy variable inline:
.PP
.RS
.nf
sudo https_proxy=http://proxy:3128 sdme fs import https://example.com/ubuntu.tar.xz \-n ubuntu
.fi
.RE
.SH SEE ALSO
.BR systemd\-nspawn (1),
.BR machinectl (1),
.BR journalctl (1),
.BR qemu\-nbd (8),
.BR overlayfs (5),
.BR sudo (8)
